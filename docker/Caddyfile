:8080 {
  encode zstd gzip

  @vscode path_regexp vscode ^/vscode(?:/.*)?$
  handle @vscode {
    reverse_proxy workspace:8300 {
      header_down -X-Frame-Options
      header_down -Content-Security-Policy
    }
  }

  @terminal1 path_regexp terminal1 ^/terminal/1(?:/.*)?$
  handle @terminal1 {
    uri strip_prefix /terminal/1
    reverse_proxy workspace:7681 {
      header_down -X-Frame-Options
      header_down -Content-Security-Policy
      transport http {
        versions 1.1
      }
    }
  }

  @terminal2 path_regexp terminal2 ^/terminal/2(?:/.*)?$
  handle @terminal2 {
    uri strip_prefix /terminal/2
    reverse_proxy workspace:7682 {
      header_down -X-Frame-Options
      header_down -Content-Security-Policy
      transport http {
        versions 1.1
      }
    }
  }

  @terminal3 path_regexp terminal3 ^/terminal/3(?:/.*)?$
  handle @terminal3 {
    uri strip_prefix /terminal/3
    reverse_proxy workspace:7683 {
      header_down -X-Frame-Options
      header_down -Content-Security-Policy
      transport http {
        versions 1.1
      }
    }
  }

  @preview path_regexp preview ^/preview(?:/.*)?$
  handle @preview {
    uri strip_prefix /preview
    reverse_proxy frontend:3000 {
      header_down -X-Frame-Options
      header_down -Content-Security-Policy
    }
  }

  @streamlit path_regexp streamlit ^/streamlit(?:/.*)?$
  handle @streamlit {
    uri strip_prefix /streamlit
    reverse_proxy streamlit:8501 {
      header_down -X-Frame-Options
      header_down -Content-Security-Policy
    }
  }

  @api path_regexp api ^/api(?:/.*)?$
  handle @api {
    uri strip_prefix /api
    reverse_proxy app:8000 {
      header_down -X-Frame-Options
      header_down -Content-Security-Policy
    }
  }

  handle {
    root * /srv/dashboard
    try_files {path} {path}/ /index.html
    file_server
  }
}
