---
id: claude-code-contract
title: Claude Code エージェント契約（行動規範・入出力仕様）
owner: Tech Lead
status: template
version: 1.0.0
---

## Claude Code エージェント契約

## 目的

Claude Code が仕様書・ユーザーストーリー・受入基準を満たす高品質なコード・テスト・ドキュメントを**自律的に**生成・修正する。

## 📥 入力仕様（必須）

### 基本情報

- ストーリーID（US-XXX 形式、トレーサビリティのため）
- 仕様書（PRD・チャーター・NFR）
- 受入基準（Gherkin ファイル形式の .feature）
- API 仕様（OpenAPI YAML 形式）
- アーキテクチャ決定（ADR ファイル）

### 技術制約

- コーディング標準（lint・format 設定）
- 許可ライブラリ（依存関係許可リスト）
- 環境制約（ランタイム・フレームワークバージョン）
- セキュリティ要件（認証・認可・データ保護方針）

## 📤 出力要件

### 必須成果物

- プルリクエスト（コード + テスト + 更新ドキュメント）
- 実行可能なテスト（Gherkin 受入テストの実装）
- テスト結果レポート（Red→Green→Refactor の TDD ログ）
- セルフドキュメント（実装判断の理由・トレードオフ）

### 品質チェックリスト

- [ ] 受入テスト 100% 合格
- [ ] 単体テストカバレッジ >= 80%
- [ ] 静的解析クリティカル問題 0 件
- [ ] セキュリティ脆弱性 0 件
- [ ] パフォーマンス基準達成
- [ ] アクセシビリティ基準準拠

## Claude Code 特有の活用指針

### 効率的なツール実行パターン

#### 複数ツールの同時呼び出し

```text
推奨: 複数のWriteツールを1つのメッセージで呼び出し
非推奨: 各ツールを個別のメッセージで順次呼び出し
```

#### TaskTool（サブエージェント活用）

```text
推奨: 「4つのエージェントでコードベースを並列分析して」
非推奨: 「コードベースを順次分析して」（単一エージェント）
```

### TodoWrite タスク管理

- 自動分解（大きなストーリーを実装可能なサブタスクに分割）
- 進捗可視化（各タスクの状態をリアルタイム更新）
- 完了基準（受入基準クリア時のみ「completed」に変更）

### 効率的開発パターン

```typescript
// 推奨パターン（同時ツール呼び出し）
Claude Code: [
  Write(api/auth.ts),
  Write(components/LoginForm.tsx),
  Write(tests/auth.test.ts)
]
// → 1つのメッセージで複数ファイルを同時生成

// 非推奨パターン（順次実行）
Claude Code:
  1. Write(api/auth.ts) → 送信・待機
  2. Write(LoginForm.tsx) → 送信・待機
  3. Write(auth.test.ts) → 送信・待機
```

### 高速検索・分析

```bash
# 情報収集フェーズ（同時実行）
Glob("**/*.{ts,py}"), Grep("function.*Auth"), Read(config)

# TaskTool活用（サブエージェント並列）
Task("API設計分析"), Task("UI要件調査"), Task("テスト戦略立案")
```

## ガードレール

### セキュリティ制約

- 機密情報（API Key・パスワード・個人情報）をコードに含めない
- 環境変数・設定ファイルで機密情報を管理
- 外部ライブラリ追加時はライセンス確認必須

### 品質制約

- 失敗時の自己修復ループ上限（3 回まで）
- テストファースト（実装前に失敗するテストを作成）
- リファクタリング（Green 後の品質向上必須）

### 開発制約

- 既存パターン踏襲（プロジェクトのコーディング規約に従う）
- 破壊的な変更を禁止（API 契約を壊す変更は事前合意必須）
- 依存関係を最小化（必要最小限のライブラリのみ追加）

## 品質基準

### テストピラミッド

```text
E2E Tests (10%)    <- Gherkin受入テスト
Integration (20%)  <- API・DB結合テスト
Unit Tests (70%)   <- 関数・クラス単体テスト
```

### パフォーマンス基準

- API レスポンス - < 200ms (95%ile)
- ページロード - < 2 秒 (初回)
- メモリ使用量 - < ベースライン + 20%

### セキュリティ基準

- **OWASP Top 10** 対応
- **依存関係の脆弱性** 0 件（high/critical）
- **機密情報漏洩** 0 件（コード・ログ・エラーメッセージ）

## 自己説明テンプレート（PR作成時）

```markdown
## 変更概要

- ストーリー: [US-XXX] [ストーリータイトル]
- 目的: [なぜこの変更が必要か]

## 実装アプローチ

- 技術選択: [使用技術・ライブラリとその理由]
- アーキテクチャ: [設計判断・パターン選択]

## テスト戦略

- [ ] Gherkin受入テスト全件合格
- [ ] 単体テストカバレッジ XX%
- [ ] パフォーマンステスト実施

## 影響範囲

- 変更ファイル: [主要な変更ファイル]
- 依存関係: [新規追加・バージョンアップ]
- 破壊的変更: [ある場合のみ記載]

## 残課題・次ステップ

- [技術的負債・改善点]
- [フォローアップが必要な事項]

## 動作確認

- [ ] ローカル環境で動作確認
- [ ] 全テスト合格
- [ ] リント・フォーマット適用済み

Generated with Claude Code
```

## 実行例

### シンプルな指示

```text
「specs/examples/todo-app.spec.md の仕様で実装して」
```

### 詳細な指示

```text
「以下の条件でeコマースプラットフォームを実装して：
- 仕様書: specs/examples/ecommerce.spec.md
- TDDで進行（Gherkinテストから開始）
- パフォーマンス最適化も含めて
- リアルタイム在庫更新（WebSocket）
- セキュリティ基準OWASP準拠」
```

### 段階的な品質向上

```text
「現在のTODOアプリをリファクタリングして品質向上させて：
- コードカバレッジ90%以上
- パフォーマンス20%改善
- アクセシビリティ対応
- セキュリティ強化」
```

## 継続改善

### エージェント学習

- 成功パターン（効果的だった実装アプローチを記録）
- 失敗パターン（トラブルが発生したケースと対策を記録）
- 品質メトリクス（テスト合格率・バグ発生率・開発速度を追跡）

### 契約更新

- プロジェクトの成熟に応じて品質基準を段階的に強化
- 新技術・フレームワーク導入時のガイドライン追加
- チームフィードバックに基づく実践的な改善

---

**この契約により、Claude Code は単なる「コード生成ツール」ではなく、「自律的な開
発パートナー」として機能します。**
